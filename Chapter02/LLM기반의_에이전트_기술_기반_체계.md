chapter02 : llm기반의 에이전트 기술 기반 체계

릴리안 윙은 llm기반의 자율 에이전트 구조를 선보였음
- 계획, 기억, 도구, 실행 4가지 구성 요소로 이루어져 있음

```
                               ┌───────────────┐
                               │    에이전트    │
                               └───────┬───────┘
         ┌───────────────┬─────────────┼───────────────┬───────────────┐
         │               │             │               │               │
   ┌─────▼─────┐   ┌─────▼─────┐       │         ┌─────▼─────┐   ┌─────▼─────┐
   │   기억    │   │   도구    │       │         │   계획    │   │   실행    │
   └─────┬─────┘   └─────┬─────┘       │         └─────┬─────┘   └───────────┘
         │               │             │               │
 ┌───────┴───────┐   ┌───┴────────────────────────┐   │
 │   단기 기억   │   │  Calendar()                │   │
 ├───────────────┤   │  Calculator()              │   │
 │   장기 기억   │   │  Code Interpreter()        │   │
 └───────────────┘   │  Search()                  │   │
                     │  기타 다양한 서비스 호출   │   │
                     └────────────────────────────┘   │
                                                         │
                             ┌───────────────────────────┴───────────────────────────┐
                             │   사고의 연쇄   │   자기 성찰과 비판   │   작은 목표 분할 │
                             └────────────────────────────────────────────────────────┘

```
1. 계획
- 에이전트는 복잡한 작업을 효과적으로 수행하기 위한 계획 능력과 의사결정 능력이 필요함
- 작은 목표로 분할, 사고의 연쇄, 자기성찰과 비판, 과거 행동에 대한 성찰이 포함됨
2. 기억
- 단기 기억과 장기 기억 두 부분으로 구성
- 단기 기억은 맥락 학습과 관련있는 프롬프트 엔지니어링의 일부
- 장기 기억은 정보의 장기 저장 및 검색과 관련 있으며, 외부 벡터 스토리지와 빠른 검색을 활용
3. 도구
- 에이전트가 호출할 수 있는 다양한 도구를 포함함
- LLM은 사전학습이 완료됨녀 기본적으로 내부 능력과 지식의 한계가 해당 시점으로 고정되며 확장하기 어려운 특성을 지니므로, 이러한 도구들이 중요함
4. 실행
- 에이전트는 계획과 기억을 바탕으로 행동을 실행함
- 외부 세계외의 상호작용이나 도구를 호출하여 작업을 완료하는 것이 포함됨

에이전트 추론 흐름
기억 갱신 -> 작업 계획 -> 도구 실행 -> 결론 도출
결론 도출하는 과정에서 완료가 되지 않으면 기억 검색부터 다시 진행

작업 수신
- 프롬프트를 통해 요청, 외부 추가 지식, 인물 설정을 읽어 작업을 수신
기억 갱신
- 특정 작업에 따라 시스템 기억을 갱신하여 처리과정에서 필요한 정보를 최신 상태로 유지
기억 검색
- 정보를 검색하거나 필요한 겨우 데이터를 잘라내어 처리
작업 계획
- 이전 단계에서 제공된 구조화된 도구, 기억, 요청 프롬프트를 바탕으로 작업 이름을 포함한 계획을 생성
도구 실행
- 작업 계획 모듈에서 작업 완료 신호가 생성되면 순환이 종료되고 에이전트에게 작업이 완료되었다고 알림
- 그렇지 않으면 지정된 도구를 호출하고 실행
결론 도출
- 시스템은 최종 답변을 요약하고 작업 처리 과정을 마침

---
llm이 에이전트에게 부여하는 계획과 의사 결정 능력은 매우 중요함
계획은 복잡한 작업을 더 작고 관리하기 쉬운 하위 작업으로 분해하는 과정임

작업 분해에는 다음과 같은 기술이 포함됨

1. 사고의 연쇄(Chain of Thought, CoT)
- 모델이 단계별로 생각하도록 유도하는 프롬프트 기술
- 모델이 큰 작업을 작은 작업으로 분해하고 자신의 사고 과정을 명확하게 설명
2. 사고의 나무(Tree of Thought, ToT)
- 각 단계에서 다양한 추론 가능성을 탐색함으로써 트리 구조를 형성
- 사고의 나무는 bfs, dfs와 같은 다양한 검색 방법을 사용할 수 잇으며, 프롬프트나 투표를 통해 각 단계를 평가할 수 있음

외부 계획기와 결합을 대표하는 것은 'llm+p'방법
계획 문제 정의 언어(Planning Domain Definition Language, PDDL)을 사용함
llm이 문제를 pddl로 변환하고 외부 계획기에 요청해 계획을 생성하고, 마지막으로 이 꼐획을 다시 자연어로 변환

자기성찰에는 다음 기술이 포함됨
1. ReAct
- 특정 작업의 행동과 언어 공간을 결합하여 모델이 환경과 상호작용하고 추론 궤적을 생성할 수 있도록 함
2. Reflexion
- 에이전트가 동적 기억과 자기 성찰 능력을 갖출 수 있도록 하여 에이전트가 과거의 행동을 회고하여 추론 능력을 향상시킬 수 있음
3. CoH(Chain of Hindsight)
- llm에게 일련의 피드백이 포함된 과거 출력을 보여주고 이를 바탕으로 자신의 출력을 개선하도록 권장

에이전트의 핵심 기능
1. ReAct기반 체계
- 대표적인 에이전트 추론 기반 체계
- 에이전트의 동적 성격과 적응성에 중점을 두고, 작업에 대해 추론할 수 있을 뿐만 아니라 상환 변화에 따라 스스로 행동을 조정할 수 있음
- 먼저 현재 상태를 감재 -> 그 결과에 따라 결정을 내리고 행동을 취하며 다시 그에 따른 상태 변화를 바탕으로 조정을 진행
2. 도구 호출
- 도구란 에이전트에 제공된 기능 함수, 코드 조각, 기타 기술 도구를 의미
- ReAct기반 체계를 바탕으로 외부 도구를 사용해 작업이나 하위 작업을 해결하려고 계속 시도하고 도구가 호출될 때마다 새로운 결과와 상태 변화가 발생
- 도구는 에이전트의 능력을 강화하고 성능과 신뢰성을 보장하는 필수적인 지원과 편의를 제공

---
llm이 기억을 형서하는 기제는 4가지로 요약할 수 있음
1. 사전 학습을 통해 기억을 형성 : 인간의 언어를 이해하고 생성하는 방법을 학습, 입력에 기반한 예측 능력이나 텍스트 생성 능력 향상 및 세계 지식과 장기 기억을 형성
2. 상황(context)과 상호작용 : 장기기억과 프롬프트를 통해 정보를 결합하여 사용. 상황정보와 llm의 기억이 충돌하면 이상적으론 llm은 더 정확하녹 상황에 맞는 응답 생성을 위해 사오항 정볼르 우선적으로 고려
3. 특정 작업에 맞게 파인튜닝하여 성능 강화
4. 외부 기억 시스템을 llm에 통합하여 성능을 강화
---
에이전트의 추론 엔진은 계획 수립, 의사 결정, 도구 호출을 통해 작업을 실행하는 핵심
langchain, llamaindex와 같은 다양한 인공지능 애플리케이션 개발 도구에서 추론 엔진으로 채택욈
ReAct기반 체계는 복잡한 추론과 효과적인 행동을 할 수 있는 에이전트의 개발을 위한 강력하면서도 유연한 구조를 제공함

ReAct체계에서는 다음과 같은 순환 고리를 형성함
사고 -> 행동 -> 관찰 -> 다시 사고
사고 : 다음 행동을 추론하는 과정으로 현재 상황을 평가 하고 가능한 행동 방안을 고려
행동 : 행동 계획을 선택하는 과정으로 사고의 결과에 따라 어떤 행동을 취할지 결정
관찰 : 행동을 실행한 후 그 결과를 관찰하고 피드백을 수집하는 과정으로 행동의 결과를 평가하며 그 결과는 다음 사고 방향에 영향을 미침

langchain을 비롯한 llm애플리케이션 개발의 핵심이념은
사람이 직접 순서를 코딩하는 대신, llm을 활용해 작업 순서를 선택하는것
이는 애플리케이션의 논리를 ai가 스스로 결정하도록 하는 새로운 프로그래밍 패러다임

ReAct기반 체꼐에 의해 에이전트의 4가지 주요 특성
1. 적응성
- 특정 알고리즘이나 기술에 의존하지 않으며, 다양한 머신러닝 방법, 추런 전략, 실행 기제와 결함
2. 상호작용성
- 지속적인 학습과 동적 지식 관리를 지원하기 때문에 이를 통해 에이전트가 환경과 상호작용하고 환경의 변화에 적응하여 행동을 최적화
3. 자율성
- 고도의 자율성을 부여하여 스스로 결정을 내릴 수 있을 뿐만 아니라 상황 변화에 따라 행동과 전략을 자율적으로 조정
4. 기능성
- 도구 호출을 통해 웹 검색, 프레젠테이션 생성 등의 특정 작업을 수행